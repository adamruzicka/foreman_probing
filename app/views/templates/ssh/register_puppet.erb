<%#
name: Register Puppet - SSH Default
job_category: Commands
description_format: Register Puppet
snippet: false
provider_type: SSH
kind: job_template
%>

yum install -y https://yum.puppetlabs.com/puppet5/puppet5-release-el-7.noarch.rpm
yum install -y puppet-agent

cat <<END > /etc/puppetlabs/puppet/puppet.conf
[agent]
server = <%= foreman_server_fqdn %>
ca_server = <%= foreman_server_fqdn %>
certname = <%= @host.certname %>
END

/opt/puppetlabs/puppet/bin/puppet agent --test

systemctl enable puppet
systemctl start puppet
